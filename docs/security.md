# Security

Current security posture and required practices for the development environment.

## Access Control
- SSH exposed on port 2222; only the `dev` user is allowed (`AllowUsers dev`).
- Password authentication disabled; public key authentication required.
- `make ssh-setup` provisions keys and updates host SSH config with `StrictHostKeyChecking accept-new`.
- SSH host keys stored persistently in `/home/dev/.security/ssh-host-keys` and generated by `scripts/start-sshd.sh` if missing.

## Container Hardening
- Containers run as non-root `dev` (UID/GID from `.env`).
- `security_opt: no-new-privileges:true` prevents privilege escalation.
- `tmpfs` mounts for `/tmp` and `/run` use `noexec,nosuid,nodev`.
- Root-sudo whitelist in Dockerfile restricted to package and group management during setup; cleaned in final stage.

## Secrets & Credentials
- Sensitive data persists in dedicated volumes:
  - `/home/dev/.security` for SSH/GPG
  - `/home/dev/.git_tools` for Git credentials/config
  - `/home/dev/.aws` for AWS CLI state
- Permissions enforced during volume initialization (`chmod 700/600` where appropriate).
- Never store secrets inside the repository; volumes handle runtime secrets.

## Package Security
- Pacman and yay installs run during image build; rerun `make build` to fetch security updates.
- Review release notes for high-profile packages (OpenSSH, kubectl, helm, AWS CLI) before upgrading.
- After updates, validate functionality (SSH connectivity, kubectl commands, etc.).

## Network Considerations
- Default Docker bridge network with subnet `172.20.0.0/16`; no inbound ports other than those exposed in compose.
- Port forwards (8080, 3000, 9000) are available for application testing; close compose services if not needed.
- Use firewall rules on the host if additional isolation is required.

## Auditing & Monitoring
- Periodically review container logs (`docker-compose logs dev-env`) for SSH attempts or failures.
- Confirm `MaxAuthTries` and `LoginGraceTime` remain in `sshd_config` to limit brute-force attempts.
- Use `docker stats dev-environment` to watch resource usage and detect abnormal behaviour.

## Incident Response
- Revoke compromised SSH keys by removing them from `/home/dev/.security/ssh/authorized_keys` and rerunning `make ssh-setup`.
- If a volume is suspected of compromise, stop containers, back up required data, remove the volume, and rerun `docker-compose up volume-init`.
- For critical vulnerabilities, rebuild the environment immediately with patched dependencies and document the change.

